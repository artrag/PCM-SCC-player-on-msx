Sjasm Z80 Assembler v0.42c - www.xl2s.tk             [2017.02.14 - 20:03:34]

SccReplayer3c_bas.asm
Errors: 5

       1   00:0000                      ;----------------------------------------------------------------------------
       2   00:0000                      ;----------------------------------------------------------------------------
       3   00:0000                      
       4   00:0000                              output "sccplay3c_bas.rom"
       5   00:4000                      
       6   00:4000                              org 4000h
       7   00:4000                              dw  4241h,START,0,0,0,0,0,0
       7   00:4000  41 42 10 40 00 00 00 00 00 00 00 00 00 00 00 00 
       8   00:4010                      
       9   00:4010                      ;	Bank 1: 6000h - 67FFh (6000h used)
      10   00:4010                      ;	Bank 2: 6800h - 6FFFh (6800h used)
      11   00:4010                      ;	Bank 3: 7000h - 77FFh (7000h used)
      12   00:4010                      ;	Bank 4: 7800h - 7FFFh (7800h used)
      13   00:4010                      
      14   00:4010                      
      15   00:4010                      ; ascii-8 mapper
      16   00:4010                      
      17   00:4010  (00:6000)           Bank1:  equ      6000h
      18   00:4010  (00:6800)           Bank2:  equ      6800h
      19   00:4010  (00:7000)           Bank3:  equ      7000h
      20   00:4010  (00:7800)           Bank4:  equ      7800h
      21   00:4010                      
      22   00:4010                      ; scc mapper for scc chip
      23   00:4010                      
      24   00:4010  (00:9000)           sccBank3:  equ      09000h
      25   00:4010                      
      26   00:4010                      ;-------------------------------------
      27   00:4010                      ; Entry point
      28   00:4010                      ;-------------------------------------
      29   00:4010                      START:
      30   00:4010  3E 28                       ld		a,40
      31   00:4012  32 AE F3            		ld		(0xF3AE),a	; screen width
      32   00:4015  AF                          xor     a
      33   00:4016  CD 5F 00                    call    005Fh
      34   00:4019  AF                          xor     a
      35   00:401A  32 DB F3            		ld		(0xF3DB),a	; no key click
      36   00:401D  CD 24 43            		call	init_mapper
      37   00:4020                      
      38   00:4020  CD 29 44            		call	search_slot
      39   00:4023  11 68 01            		ld		de,40*9
      40   00:4026  21 36 41            		ld		hl,rom_slot_text
      41   00:4029  CD EC 40            		call	message
      42   00:402C  11 72 01                    ld      de,40*9+10
      43   00:402F  2A 12 FD            		ld		hl,(slotvar)
      44   00:4032  26 00               		ld		h,0
      45   00:4034  CD 36 43                    call    PrintNum
      46   00:4037                      
      47   00:4037  CD 48 44            		call	search_slotram
      48   00:403A  11 90 01            		ld		de,40*10
      49   00:403D  21 41 41            		ld		hl,ram_slot_text
      50   00:4040  CD EC 40            		call	message
      51   00:4043  11 9A 01                    ld      de,40*10+10
      52   00:4046  2A 13 FD            		ld		hl,(slotram)
      53   00:4049  26 00               		ld		h,0
      54   00:404B  CD 36 43                    call    PrintNum
      55   00:404E                      
      56   00:404E  CD 8B 45                    call    SCCsearch
      57   00:4051  11 40 01            		ld		de,40*8
      58   00:4054  21 2B 41            		ld		hl,scc_slot_text
      59   00:4057  CD EC 40            		call	message
      60   00:405A  11 4A 01                    ld      de,40*8+10
      61   00:405D  2A 14 FD            		ld		hl,(SCC)
      62   00:4060  26 00               		ld		h,0
      63   00:4062  CD 36 43                    call    PrintNum
      64   00:4065                      
      65   00:4065  3A 14 FD            		ld		a,(SCC)
      66   00:4068  3C                  		inc		a
      67   00:4069  20 0A               		jr		nz,1f
      68   00:406B  11 7D 00            		ld		de,3*40+5
      69   00:406E  21 FE 40            		ld		hl,noSCC_text
      70   00:4071  CD EC 40            		call	message
      71   00:4074  C9                  		ret
      72   00:4075                      1:
      73   00:4075  CD 9E 45            		call	en_scc
      74   00:4078                      
      75   00:4078  F3                          di
      76   00:4079                      
      77   00:4079  3E 3F                       ld      a,3Fh
      78   00:407B  32 00 90                    ld      (sccBank3),a
      79   00:407E                      
      80   00:407E  CD 90 43                    call    SccAdjust
      81   00:4081  CD E0 43                    call    SccInit
      82   00:4084  CD 1C 43                    call    ReplayerMute
      83   00:4087  CD 10 44                    call    SccMute
      84   00:408A  CD 4C 41                    call    InstallIntHanlder
      85   00:408D                      
      86   00:408D                      
      87   00:408D                       ; print period from SccAdjust
      88   00:408D                      
      89   00:408D  2A 0D FD                    ld      hl,(Period)
      90   00:4090  11 00 00                    ld      de,0
      91   00:4093  CD 36 43                    call    PrintNum
      92   00:4096                      
      93   00:4096  11 7D 00            		ld		de,3*40+5
      94   00:4099  21 0F 41            		ld		hl,instruction_text
      95   00:409C  CD EC 40            		call	message
      96   00:409F                      
      97   00:409F                      
      98   00:409F  FB                          ei
      99   00:40A0  C9                  		ret
     100   00:40A1                      
     101   00:40A1                      
     102   00:40A1                      .halt:
     103   00:40A1                      
     104   00:40A1                      ; print blocks to play
     105   00:40A1  76                          halt
     106   00:40A2  2A 0F FD                    ld      hl,(NumBlocksToPlay)
     107   00:40A5  11 08 00                    ld      de,8
     108   00:40A8  CD 36 43                    call    PrintNum
     109   00:40AB                      
     110   00:40AB  2A 09 FD                    ld      hl,(SamplePos)
     111   00:40AE  11 10 00                    ld      de,16
     112   00:40B1  CD 36 43                    call    PrintNum
     113   00:40B4                      
     114   00:40B4  2A 0B FD                    ld      hl,(SamplePage)
     115   00:40B7  26 00                       ld      h,0
     116   00:40B9  11 18 00                    ld      de,24
     117   00:40BC  CD 36 43                    call    PrintNum
     118   00:40BF                      
     119   00:40BF                      ; play one sfx at time
     120   00:40BF  3A 11 FD            		ld      a,(SccSfxOn)
     121   00:40C2  B7                          or      a
     122   00:40C3  CC C7 40            		call	z,effetct24
     123   00:40C6  C9                  		ret
     124   00:40C7                      
     125   00:40C7                      ; Keyboard testing
     126   00:40C7                      ; 2 "B" "A" ??? "/" "." "," "'" "`"
     127   00:40C7                      ; 3 "J" "I" "H" "G" "F" "E" "D" "C"
     128   00:40C7                      ; 4 "R" "Q" "P" "O" "N" "M" "L" "K"
     129   00:40C7                      ; 5 "Z" "Y" "X" "W" "V" "U" "T" "S"
     130   00:40C7                      ; 6 F3 F2  F1 CODE CAP GRAPH CTR SHIFT
     131   00:40C7                      ; 7 RET SEL BS STOP TAB ESC F5  F4
     132   00:40C7                      ; 8 RIGHT DOWN UP LEFT DEL INS HOME SPACE
     133   00:40C7                      
     134   00:40C7                      effetct24:
     135   00:40C7                      
     136   00:40C7  11 03 00            		ld      de,3
     137   00:40CA  D5                  2: 		push	de
     138   00:40CB  CD 1E 44             		call    checkkbd
     139   00:40CE  06 08                		ld      b,8
     140   00:40D0  4F                   		ld      c,a
     141   00:40D1                      1:
     142   00:40D1  78                   		ld      a,b
     143   00:40D2  3D                   		dec     a
     144   00:40D3  82                  		add		a,d
     145   00:40D4  6F                   		ld      l,a
     146   00:40D5  79                   		ld      a,c
     147   00:40D6  87                   		add     a,a
     148   00:40D7  4F                   		ld      c,a
     149   00:40D8  C5                   		push    bc
     150   00:40D9  7D                   		ld      a,l
     151   00:40DA  D4 A1 41             		call    nc,ReplayerInit
     152   00:40DD  C1                   		pop     bc
     153   00:40DE  10 F1                		djnz    1B
     154   00:40E0  D1                  		pop		de
     155   00:40E1  3E 08               		ld		a,8
     156   00:40E3  82                  		add		a,d
     157   00:40E4  57                  		ld		d,a
     158   00:40E5  1C                  		inc		e
     159   00:40E6  3E 08               		ld		a,8
     160   00:40E8  BB                  		cp		e
     161   00:40E9  30 DF               		jr		nc,2B
     162   00:40EB                      
     163   00:40EB  C9                   		ret
     164   00:40EC                      ;-------------------------------------
     165   00:40EC                      ;-------------------------------------
     166   00:40EC                      message:
     167   00:40EC  7B                          ld      a,e
     168   00:40ED  D3 99                       out     (99h),a
     169   00:40EF  7A                          ld      a,d
     170   00:40F0  E6 3F                       and     3Fh
     171   00:40F2  F6 40                       or      40h
     172   00:40F4  D3 99                       out     (99h),a
     173   00:40F6                      
     174   00:40F6  7E                  1:		ld		a,(hl)
     175   00:40F7  A7                  		and		a
     176   00:40F8  C8                  		ret		z
     177   00:40F9  D3 98               		out     (98h),a
     178   00:40FB  23                  		inc		hl
     179   00:40FC  18 F8               		jr		1b
     180   00:40FE                      		
     181   00:40FE                      noSCC_text:
     182   00:40FE                      		db "No SCC detected.",0
     182   00:40FE  4E 6F 20 53 43 43 20 64 65 74 65 63 74 65 64 2E 
     182   00:410E  00 
     183   00:410F                      instruction_text:
     184   00:410F                      		db "use USR0(n) with n in 0-11 ",0
     184   00:410F  75 73 65 20 55 53 52 30 28 6E 29 20 77 69 74 68 
     184   00:411F  20 6E 20 69 6E 20 30 2D 31 31 20 00 
     185   00:412B                      scc_slot_text:
     186   00:412B                      		db	"Scc slot: ",0
     186   00:412B  53 63 63 20 73 6C 6F 74 3A 20 00 
     187   00:4136                      rom_slot_text:
     188   00:4136                      		db	"Rom slot: ",0
     188   00:4136  52 6F 6D 20 73 6C 6F 74 3A 20 00 
     189   00:4141                      ram_slot_text:
     190   00:4141                      		db	"Ram slot: ",0
     190   00:4141  52 61 6D 20 73 6C 6F 74 3A 20 00 
     191   00:414C                      
     192   00:414C                      ;-------------------------------------
     193   00:414C                      ;-------------------------------------
     194   00:414C                      InstallIntHanlder:
     195   00:414C  F3                          di
     196   00:414D  3E F7                       ld      a,0xF7
     197   00:414F  32 9A FD                    ld      ($FD9A),a
     198   00:4152  3A 12 FD            		ld		a,(slotvar)
     199   00:4155  32 9B FD            		ld		($FD9B),a
     200   00:4158  21 91 41                    ld      hl,HandleInt
     201   00:415B  22 9C FD                    ld      ($FD9C),hl
     202   00:415E  3E C9                       ld      a,0xC9
     203   00:4160  32 9E FD                    ld      ($FD9E),a
     204   00:4163                      		
     205   00:4163  21 16 FD            		ld		hl,USR0
     206   00:4166  22 9A F3            		ld		(0xF39A),hl
     207   00:4169                      
     208   00:4169  3E F7                       ld      a,0xF7
     209   00:416B  32 16 FD                    ld      (USR0+0),a
     210   00:416E  3A 12 FD            		ld		a,(slotvar)
     211   00:4171  32 17 FD            		ld		(USR0+1),a
     212   00:4174  21 80 41                    ld      hl,HandleUsr
     213   00:4177  22 18 FD                    ld      (USR0+2),hl
     214   00:417A  3E C9                       ld      a,0xC9
     215   00:417C  32 1A FD                    ld      (USR0+4),a
     216   00:417F                      		
     217   00:417F  C9                          ret
     218   00:4180                      		
     219   00:4180                      HandleUsr:
     220   00:4180  3A 63 F6            		ld		a,(0xF663)
     221   00:4183  FE 02               		cp		2
     222   00:4185  C0                  		ret		nz
     223   00:4186  3A 11 FD            		ld      a,(SccSfxOn)		; play one sfx at time
     224   00:4189  B7                          or      a
     225   00:418A  C0                  		ret		nz
     226   00:418B  2A F8 F7            		ld		hl,(0xF7F8)
     227   00:418E  C3 A1 41            		jp    	ReplayerInit
     228   00:4191                      
     229   00:4191                      HandleInt:
     230   00:4191  F5                          push    af
     231   00:4192  CD 9E 45            		call	en_scc				; scc in page 2
     232   00:4195                      		
     233   00:4195  3A 11 FD                    ld      a,(SccSfxOn)
     234   00:4198  B7                          or      a
     235   00:4199  C4 F6 41                    call    nz,ReplayerUpdate
     236   00:419C                      
     237   00:419C  CD BA 45            		call	en_slot
     238   00:419F  F1                          pop     af
     239   00:41A0  C9                  		ret
     240   00:41A1                      
     241   00:41A1                      ;-------------------------------------
     242   00:41A1                      ; Initialize replayer
     243   00:41A1                      ;
     244   00:41A1                      ; in :
     245   00:41A1                      ; l  # of Sfx
     246   00:41A1                      ;
     247   00:41A1                      ;-------------------------------------
     248   00:41A1                      ReplayerInit:
     249   00:41A1  26 00                       ld      h,0
     250   00:41A3                      
     251   00:41A3  54                          ld      d,h
     252   00:41A4  5D                          ld      e,l
     253   00:41A5                      
     254   00:41A5  29                          add     hl,hl
     255   00:41A6  29                          add     hl,hl
     256   00:41A7  19                          add     hl,de
     257   00:41A8                      
     258   00:41A8  11 C9 41                    ld      de,SfxTable
     259   00:41AB  19                          add     hl,de
     260   00:41AC                      
     261   00:41AC  5E                          ld      e,(hl)
     262   00:41AD  23                          inc     hl
     263   00:41AE  56                          ld      d,(hl)
     264   00:41AF  23                          inc     hl
     265   00:41B0  ED 53 09 FD                 ld      (SamplePos),de
     266   00:41B4                      
     267   00:41B4  7E                          ld      a,(hl)
     268   00:41B5  23                          inc     hl
     269   00:41B6  32 0B FD                    ld      (SamplePage),a
     270   00:41B9  32 00 68                    ld      (Bank2),a
     271   00:41BC                      
     272   00:41BC  5E                          ld      e,(hl)
     273   00:41BD  23                          inc     hl
     274   00:41BE  56                          ld      d,(hl)
     275   00:41BF  ED 53 0F FD                 ld      (NumBlocksToPlay),de
     276   00:41C3                      
     277   00:41C3  3E FF                       ld      a,0FFh
     278   00:41C5  32 11 FD                    ld      (SccSfxOn),a
     279   00:41C8                      
     280   00:41C8  C9                          ret
     281   00:41C9                      
     282   00:41C9                      SfxTable:
     283   00:41C9                               include SfxTable.asm
       1.  00:41C9  (00:0009)           nwavs:       equ  9
       2.  00:41C9                      
       3.  00:41C9  00 60                        dw     06000h + (s0_START & 01FFFH)
       4.  00:41CB  01                           db     s0_START/02000h-2
       5.  00:41CC  64 00                        dw     (s0_END - s0_START+95)/96
       6.  00:41CE                          
       7.  00:41CE  80 65                        dw     06000h + (s1_START & 01FFFH)
       8.  00:41D0  02                           db     s1_START/02000h-2
       9.  00:41D1  50 00                        dw     (s1_END - s1_START+95)/96
      10.  00:41D3                          
      11.  00:41D3  80 63                        dw     06000h + (s2_START & 01FFFH)
      12.  00:41D5  03                           db     s2_START/02000h-2
      13.  00:41D6  09 00                        dw     (s2_END - s2_START+95)/96
      14.  00:41D8                          
      15.  00:41D8  E0 66                        dw     06000h + (s3_START & 01FFFH)
      16.  00:41DA  03                           db     s3_START/02000h-2
      17.  00:41DB  60 00                        dw     (s3_END - s3_START+95)/96
      18.  00:41DD                          
      19.  00:41DD  E0 6A                        dw     06000h + (s4_START & 01FFFH)
      20.  00:41DF  04                           db     s4_START/02000h-2
      21.  00:41E0  03 00                        dw     (s4_END - s4_START+95)/96
      22.  00:41E2                          
      23.  00:41E2  00 6C                        dw     06000h + (s5_START & 01FFFH)
      24.  00:41E4  04                           db     s5_START/02000h-2
      25.  00:41E5  0F 00                        dw     (s5_END - s5_START+95)/96
      26.  00:41E7                          
      27.  00:41E7  A0 71                        dw     06000h + (s6_START & 01FFFH)
      28.  00:41E9  04                           db     s6_START/02000h-2
      29.  00:41EA  3F 00                        dw     (s6_END - s6_START+95)/96
      30.  00:41EC                          
      31.  00:41EC  40 69                        dw     06000h + (s7_START & 01FFFH)
      32.  00:41EE  05                           db     s7_START/02000h-2
      33.  00:41EF  89 00                        dw     (s7_END - s7_START+95)/96
      34.  00:41F1                          
      35.  00:41F1  A0 7C                        dw     06000h + (s8_START & 01FFFH)
      36.  00:41F3  06                           db     s8_START/02000h-2
      37.  00:41F4  1E 01                        dw     (s8_END - s8_START+95)/96
      38.  00:41F6                          
     284   00:41F6                      
     285   00:41F6                      
     286   00:41F6                      ;-------------------------------------
     287   00:41F6                      ; write 32 samples and moves sample pointer to next page
     288   00:41F6                      ;-------------------------------------
     289   00:41F6                      		macro	my_ldir
     290   00:41F6                    <         repeat  32
     291   00:41F6                    <         ldi						; 18*32
     292   00:41F6                    <         endrepeat
     293   00:41F6                    <         bit     7,h				; 10
     294   00:41F6                    <         jp 		z,1f			; 11
     295   00:41F6                    <         ld      a,(SamplePage)
     296   00:41F6                    <         inc     a
     297   00:41F6                    <         ld      (SamplePage),a
     298   00:41F6                    <         ld      (Bank2),a
     299   00:41F6                    <         ld		h,060h
     300   00:41F6                    <         ld      a,(Period)
     301   00:41F6                    < 1:		nop						; 10 dummy
     302   00:41F6                    < 		nop						; 1 cycle is missing
     303   00:41F6                    < 		endm
     304   00:41F6                      		
     305   00:41F6                      		
     306   00:41F6                      ReplayerUpdate:
     307   00:41F6  2A 09 FD                    ld      hl,(SamplePos)
     308   00:41F9  3A 0D FD                    ld      a,(Period)
     309   00:41FC  11 00 98                    ld      de,9800h
     310   00:41FF                      
     311   00:41FF                              ;622 cycles except at bank swap
     312   00:41FF                      
     313   00:41FF                              ; phase 0
     314   00:41FF                              my_ldir
     314   00:41FF                    >         repeat  32
     314   00:41FF                    <         ldi
     314   00:41FF                    <         endrepeat
     314   00:41FF  ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 
     314   00:420F  ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 
     314   00:421F  ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 
     314   00:422F  ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 
     314   00:423F  CB 7C             >         bit     7,h
     314   00:4241  CA 53 42          >         jp   z,1f
     314   00:4244  3A 0B FD          >         ld      a,(SamplePage)
     314   00:4247  3C                >         inc     a
     314   00:4248  32 0B FD          >         ld      (SamplePage),a
     314   00:424B  32 00 68          >         ld      (Bank2),a
     314   00:424E  26 60             >         ld  h,060h
     314   00:4250  3A 0D FD          >         ld      a,(Period)
     314   00:4253  00                > 1:  nop
     314   00:4254  00                >   nop
     315   00:4255  32 80 98                    ld      (9880h),a       ; 14
     316   00:4258                      		
     317   00:4258                              ; phase 1
     318   00:4258                              my_ldir
     318   00:4258                    >         repeat  32
     318   00:4258                    <         ldi
     318   00:4258                    <         endrepeat
     318   00:4258  ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 
     318   00:4268  ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 
     318   00:4278  ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 
     318   00:4288  ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 
     318   00:4298  CB 7C             >         bit     7,h
     318   00:429A  CA AC 42          >         jp   z,1f
     318   00:429D  3A 0B FD          >         ld      a,(SamplePage)
     318   00:42A0  3C                >         inc     a
     318   00:42A1  32 0B FD          >         ld      (SamplePage),a
     318   00:42A4  32 00 68          >         ld      (Bank2),a
     318   00:42A7  26 60             >         ld  h,060h
     318   00:42A9  3A 0D FD          >         ld      a,(Period)
     318   00:42AC  00                > 1:  nop
     318   00:42AD  00                >   nop
     319   00:42AE  32 82 98                    ld      (9882h),a		; 14
     320   00:42B1                      		
     321   00:42B1                              ; phase 2
     322   00:42B1                              my_ldir
     322   00:42B1                    >         repeat  32
     322   00:42B1                    <         ldi
     322   00:42B1                    <         endrepeat
     322   00:42B1  ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 
     322   00:42C1  ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 
     322   00:42D1  ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 
     322   00:42E1  ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 ED A0 
     322   00:42F1  CB 7C             >         bit     7,h
     322   00:42F3  CA 05 43          >         jp   z,1f
     322   00:42F6  3A 0B FD          >         ld      a,(SamplePage)
     322   00:42F9  3C                >         inc     a
     322   00:42FA  32 0B FD          >         ld      (SamplePage),a
     322   00:42FD  32 00 68          >         ld      (Bank2),a
     322   00:4300  26 60             >         ld  h,060h
     322   00:4302  3A 0D FD          >         ld      a,(Period)
     322   00:4305  00                > 1:  nop
     322   00:4306  00                >   nop
     323   00:4307  32 84 98                    ld      (9884h),a		; 14
     324   00:430A                      
     325   00:430A  22 09 FD                    ld      (SamplePos),hl
     326   00:430D                      
     327   00:430D  3E 07               		ld      a,00000111b     ; channels 1-3 active
     328   00:430F  32 8F 98                    ld      (988Fh),a
     329   00:4312  2A 0F FD                    ld      hl,(NumBlocksToPlay)
     330   00:4315  2B                          dec     hl                       ; does NOT affect Z flag
     331   00:4316  22 0F FD                    ld      (NumBlocksToPlay),hl
     332   00:4319                      
     333   00:4319  7C                          ld      a,h
     334   00:431A  B5                          or      l
     335   00:431B  C0                  		ret		nz
     336   00:431C                      
     337   00:431C                      ;-------------------------------------
     338   00:431C                      ; Mute replayer
     339   00:431C                      ;-------------------------------------
     340   00:431C                      ReplayerMute:
     341   00:431C                      
     342   00:431C  AF                          xor      a
     343   00:431D  32 11 FD                    ld      (SccSfxOn),a
     344   00:4320  32 8F 98                    ld      (988Fh),a	; all channels inactive
     345   00:4323  C9                          ret
     346   00:4324                      
     347   00:4324                      
     348   00:4324                      ;-------------------------------------
     349   00:4324                      ; To make rom guesseres happy
     350   00:4324                      ;-------------------------------------
     351   00:4324                      init_mapper:
     352   00:4324  3E 00                       ld     a,init_mapper/02000h-2
     353   00:4326  32 00 60                    ld      (Bank1),a
     354   00:4329  3C                  		inc		a
     355   00:432A  32 00 68                    ld      (Bank2),a
     356   00:432D  3C                  		inc		a
     357   00:432E  32 00 70                    ld      (Bank3),a
     358   00:4331  3C                  		inc		a
     359   00:4332  32 00 78                    ld      (Bank4),a
     360   00:4335  C9                          ret
     361   00:4336                      
     362   00:4336                      ;-------------------------------------
     363   00:4336                      ; method that prints hl on screen
     364   00:4336                      ; to address de
     365   00:4336                      ;-------------------------------------
     366   00:4336                      PrintNum:
     367   00:4336  7B                          ld      a,e
     368   00:4337  D3 99                       out     (99h),a
     369   00:4339  7A                          ld      a,d
     370   00:433A  E6 3F                       and     3Fh
     371   00:433C  F6 40                       or      40h
     372   00:433E  D3 99                       out     (99h),a
     373   00:4340                      
     374   00:4340  E5                          push    hl
     375   00:4341  EB                          ex      de,hl
     376   00:4342                      
     377   00:4342  7A                          ld      a,d
     378   00:4343  07                          rlca
     379   00:4344  07                          rlca
     380   00:4345  07                          rlca
     381   00:4346  07                          rlca
     382   00:4347  E6 0F                       and     15
     383   00:4349  06 00                       ld      b,0
     384   00:434B  4F                          ld      c,a
     385   00:434C  21 80 43                    ld      hl,Numbers
     386   00:434F  09                          add     hl,bc
     387   00:4350  7E                          ld      a,(hl)
     388   00:4351  D3 98                       out     (98h),a
     389   00:4353                      
     390   00:4353  7A                          ld      a,d
     391   00:4354  E6 0F                       and     15
     392   00:4356  06 00                       ld      b,0
     393   00:4358  4F                          ld      c,a
     394   00:4359  21 80 43                    ld      hl,Numbers
     395   00:435C  09                          add     hl,bc
     396   00:435D  7E                          ld      a,(hl)
     397   00:435E  D3 98                       out     (98h),a
     398   00:4360                      
     399   00:4360  7B                          ld      a,e
     400   00:4361  07                          rlca
     401   00:4362  07                          rlca
     402   00:4363  07                          rlca
     403   00:4364  07                          rlca
     404   00:4365  E6 0F                       and     15
     405   00:4367  06 00                       ld      b,0
     406   00:4369  4F                          ld      c,a
     407   00:436A  21 80 43                    ld      hl,Numbers
     408   00:436D  09                          add     hl,bc
     409   00:436E  7E                          ld      a,(hl)
     410   00:436F  D3 98                       out     (98h),a
     411   00:4371                      
     412   00:4371  7B                          ld      a,e
     413   00:4372  E6 0F                       and     15
     414   00:4374  06 00                       ld      b,0
     415   00:4376  4F                          ld      c,a
     416   00:4377  21 80 43                    ld      hl,Numbers
     417   00:437A  09                          add     hl,bc
     418   00:437B  7E                          ld      a,(hl)
     419   00:437C  D3 98                       out     (98h),a
     420   00:437E                      
     421   00:437E  E1                          pop     hl
     422   00:437F  C9                          ret
     423   00:4380                      
     424   00:4380                      Numbers:
     425   00:4380                              db  "0123456789ABCDEF"
     425   00:4380  30 31 32 33 34 35 36 37 38 39 41 42 43 44 45 46 
     426   00:4390                      
     427   00:4390                      ;-------------------------------------
     428   00:4390                      ; Adjusts the SCC period to the frame
     429   00:4390                      ; rate
     430   00:4390                      ;-------------------------------------
     431   00:4390                      
     432   00:4390  (00:08BC)           Period50: equ       (3579545/32/50-1)
     433   00:4390  (00:0749)           Period60: equ       (3579545/32*1001/(60*1000)-1)
     434   00:4390                      
     435   00:4390                      ;Period60: equ      749h
     436   00:4390                      
     437   00:4390                      SccAdjust:
     438   00:4390  21 49 07            		ld      hl,Period60
     439   00:4393  22 0D FD            		ld      (Period),hl
     440   00:4396                      
     441   00:4396  1E 07                       ld      e,7					;    7   |   RET   SEL   BS   STOP   TAB   ESC   F5    F4
     442   00:4398  CD 1E 44                    call    checkkbd
     443   00:439B  FE FB                       cp      11111011b           ; key ESC
     444   00:439D  C0                          ret     nz
     445   00:439E                      
     446   00:439E                              ; press ESC at boot to start the frequency test
     447   00:439E                      		; WARNING it hangs on SCC+
     448   00:439E                      
     449   00:439E  3E 18                       ld      a,00011000b
     450   00:43A0  32 8F 98                    ld      (988Fh),a		; activate ch 4 & 5 for testing
     451   00:43A3                      
     452   00:43A3  21 60 98                    ld      hl,9800h+32*3   ; counter in channel 4
     453   00:43A6  01 00 20                    ld      bc,2000h
     454   00:43A9                      .counter:
     455   00:43A9  71                          ld      (hl),c
     456   00:43AA  23                          inc     hl
     457   00:43AB  0C                          inc     c
     458   00:43AC  10 FB                       djnz    .counter
     459   00:43AE                      
     460   00:43AE  3E A0                       ld      a,10100000b     	; rotate channel 4&5 with ch4 freq., reset wav if freq is written
     461   00:43B0  32 E0 98                    ld      (98E0h),a			; on SCC
     462   00:43B3  32 C0 98                    ld  	(98C0h),a			; cover SCC+ in SCC mode
     463   00:43B6                      
     464   00:43B6  21 45 07                    ld      hl,Period60-4
     465   00:43B9  DB 99                       in      a,(99h)
     466   00:43BB  C3 D6 43            		jp		2f					; expect in C any value > 31
     467   00:43BE                      
     468   00:43BE                      .loop:
     469   00:43BE                      
     470   00:43BE  DB 99               1:      in      a,(99h)
     471   00:43C0  E6 80                       and     80h
     472   00:43C2  CA BE 43                    jp      z,1B         ; wait vblank
     473   00:43C5                      
     474   00:43C5  3A 60 98                    ld      a,(9800h+32*3)
     475   00:43C8  B9                          cp      c
     476   00:43C9  CA DC 43                    jp      z,.end
     477   00:43CC                      
     478   00:43CC  0E 1F                       ld      c,31
     479   00:43CE  23                          inc     hl
     480   00:43CF                      
     481   00:43CF  DB 99               1:      in      a,(99h)
     482   00:43D1  E6 80                       and     80h
     483   00:43D3  CA CF 43                    jp      z,1B         ; wait vblank
     484   00:43D6                      2:
     485   00:43D6  22 86 98                    ld      (9886h),hl
     486   00:43D9                      ;        ld      (9888h),hl	; ch5 not needed
     487   00:43D9  C3 BE 43                    jp      .loop
     488   00:43DC                      .end:
     489   00:43DC  22 0D FD                    ld      (Period),hl
     490   00:43DF                      
     491   00:43DF  C9                          ret
     492   00:43E0                      
     493   00:43E0                      ;-------------------------------------
     494   00:43E0                      ; Initialize the scc
     495   00:43E0                      ;-------------------------------------
     496   00:43E0                      SccInit:
     497   00:43E0  CD 10 44                    call SccMute
     498   00:43E3                      
     499   00:43E3  3E 20                       ld  	a,00100000b         ; Reset phase when freq is written
     500   00:43E5  32 E0 98                    ld  	(98E0h),a			; on SCC
     501   00:43E8  32 C0 98                    ld  	(98C0h),a			; cover SCC+ in SCC mode
     502   00:43EB                      
     503   00:43EB  3E 0F                       ld      a,15
     504   00:43ED  32 8A 98                    ld      (988Ah),a       ; volume ch1
     505   00:43F0  32 8B 98                    ld      (988Bh),a       ; volume ch2
     506   00:43F3  32 8C 98                    ld      (988Ch),a       ; volume ch3
     507   00:43F6  AF                  		xor		a
     508   00:43F7  32 8D 98                    ld      (988Dh),a       ; volume ch4
     509   00:43FA  32 8E 98                    ld      (988Eh),a       ; experiment on ch4&5
     510   00:43FD                      
     511   00:43FD  2A 0D FD                    ld      hl,(Period)
     512   00:4400  22 80 98                    ld      (9880h),hl
     513   00:4403  22 82 98                    ld      (9882h),hl
     514   00:4406  22 84 98                    ld      (9884h),hl
     515   00:4409  22 86 98                    ld      (9886h),hl			; experiment on ch 4&5
     516   00:440C  22 88 98                    ld      (9888h),hl
     517   00:440F                      
     518   00:440F  C9                          ret
     519   00:4410                      
     520   00:4410                      SccMute:
     521   00:4410  21 00 98                    ld      hl,9800h
     522   00:4413  11 01 98                    ld      de,9801h
     523   00:4416  01 7F 00                    ld      bc,32*4 -1
     524   00:4419                      
     525   00:4419  36 00                       ld      (hl),0
     526   00:441B  ED B0                       ldir
     527   00:441D  C9                          ret
     528   00:441E                      
     529   00:441E                      ;-------------------------------------
     530   00:441E                      ; checkkbd: ckeck keyboard line
     531   00:441E                      ; syntax:checkkbd <keyboar line #>
     532   00:441E                      ; in:  e
     533   00:441E                      ; out: l
     534   00:441E                      ;-------------------------------------
     535   00:441E                      ; i8255 ports
     536   00:441E                      ;
     537   00:441E  (00:00A8)           i8255porta  equ 0a8h        ; slot selection
     538   00:441E  (00:00A9)           i8255portb  equ 0a9h        ; keyboard column input
     539   00:441E  (00:00AA)           i8255portc  equ 0aah        ; leds, motor, cassette, kbd line
     540   00:441E  (00:00AB)           i8255portd  equ 0abh        ; mode select for i8255 ports A,B,C
     541   00:441E                      
     542   00:441E                      checkkbd:
     543   00:441E  DB AA                       in  a,(i8255portc)
     544   00:4420  E6 F0                       and 011110000B          ; upper 4 bits contain info to preserve
     545   00:4422  B3                          or  e
     546   00:4423  D3 AA                       out (i8255portc),a
     547   00:4425  DB A9                       in  a,(i8255portb)
     548   00:4427  6F                          ld  l,a
     549   00:4428  C9                          ret
     550   00:4429                      
     551   00:4429                      ; #define right (!(kbd & 128))
     552   00:4429                      ; #define left 	(!(kbd & 16))
     553   00:4429                      ; #define up 	(!(kbd & 32))
     554   00:4429                      ; #define down 	(!(kbd & 64))
     555   00:4429                      ; // space
     556   00:4429                      ; #define key1 	(!(kbd & 1))
     557   00:4429                      ; // M
     558   00:4429                      ; #define key2 	(!(kb2 & 4))
     559   00:4429                      
     560   00:4429                      ;  Bit_7 Bit_6 Bit_5 Bit_4 Bit_3 Bit_2 Bit_1 Bit_0
     561   00:4429                      ; 0 "7" "6" "5" "4" "3" "2" "1" "0"
     562   00:4429                      ; 1 ";" "]" "[" "\" "=" "-" "9" "8"
     563   00:4429                      ; 2 "B" "A" ??? "/" "." "," "'" "`"
     564   00:4429                      ; 3 "J" "I" "H" "G" "F" "E" "D" "C"
     565   00:4429                      ; 4 "R" "Q" "P" "O" "N" "M" "L" "K"
     566   00:4429                      ; 5 "Z" "Y" "X" "W" "V" "U" "T" "S"
     567   00:4429                      ; 6 F3 F2  F1 CODE CAP GRAPH CTR SHIFT
     568   00:4429                      ; 7 RET SEL BS STOP TAB ESC F5  F4
     569   00:4429                      ; 8 RIGHT DOWN UP LEFT DEL INS HOME SPACE
     570   00:4429                      
     571   00:4429                      
     572   00:4429                      ;-------------------------------------
     573   00:4429                      ; SCC and Slot management
     574   00:4429                      ;-------------------------------------
     575   00:4429                               include rominit64.asm
       1.  00:4429                      
       2.  00:4429                      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
       3.  00:4429                      ; set pages and subslot
       4.  00:4429                      ;
       5.  00:4429                      
       6.  00:4429                      
       7.  00:4429  (00:0024)           ENASLT:			equ		024h
       8.  00:4429  (00:0138)           RSLREG:			equ		0138h
       9.  00:4429  (00:013B)           WSLREG:			equ		013Bh
      10.  00:4429  (00:FCC1)           EXPTBL:			equ		0FCC1h	; Bios Slot / Expansion Slot
      11.  00:4429                      
      12.  00:4429                      
      13.  00:4429                      ; ----------------------------
      14.  00:4429                      ; pre-set main slot for page 3
      15.  00:4429                      ; and set sub-slot for page 3
      16.  00:4429                      ; ----------------------------
      17.  00:4429                      	macro	mainslot_setup n
      18.  00:4429                    < 	and		3
      19.  00:4429                    < [2]	rrca
      20.  00:4429                    < 	and		0xC0
      21.  00:4429                    < 	ld		c,a
      22.  00:4429                    < 	ld		a,d
      23.  00:4429                    < 	and		0x3F
      24.  00:4429                    < 	or		c
      25.  00:4429                    < 	ld		c,a					; Primary slot value with main slot in page 3
      26.  00:4429                    < 
      27.  00:4429                    < 	ld		a,b
      28.  00:4429                    < 	and		0x0C
      29.  00:4429                    < [2]	rrca
      30.  00:4429                    < 	and		3
      31.  00:4429                    < 	ld		b,a					; B = Expanded slot in page 3
      32.  00:4429                    < 	ld		a,c
      33.  00:4429                    < 	out		(0A8h),a			; Slot : Main Slot, xx, xx, Main slot
      34.  00:4429                    < 	ld		a,(0FFFFh)
      35.  00:4429                    < 	cpl
      36.  00:4429                    < 	if (n<=4)
      37.  00:4429                    < [n]	RLCA
      38.  00:4429                    < 	else
      39.  00:4429                    < [8-n] RRCA	
      40.  00:4429                    < 	endif
      41.  00:4429                    < 	and		0xFC
      42.  00:4429                    < 	or		b
      43.  00:4429                    < 	if (n<=4)
      44.  00:4429                    < [n]	RRCA
      45.  00:4429                    < 	else
      46.  00:4429                    < [8-n] RLCA
      47.  00:4429                    < 	endif
      48.  00:4429                    < 	ld		(0FFFFh),a		; Expanded slot selected
      49.  00:4429                    < 	ld		b,a				; save for later	
      50.  00:4429                    < 	endmacro
      51.  00:4429                      		
      52.  00:4429                      
      53.  00:4429                      ; ------------------------------
      54.  00:4429                      ; SEARCH_SLOT
      55.  00:4429                      ; look for the slot of our rom
      56.  00:4429                      ; active in page 1
      57.  00:4429                      ; ------------------------------
      58.  00:4429                      
      59.  00:4429                      search_slot:
      60.  00:4429  CD 38 01            	call	RSLREG
      61.  00:442C  0F 0F               [2]	rrca
      62.  00:442E  E6 03               	and		3
      63.  00:4430  4F                  	ld		c,a
      64.  00:4431  06 00               	ld		b,0
      65.  00:4433  21 C1 FC            	ld		hl,EXPTBL
      66.  00:4436  09                  	add		hl,bc
      67.  00:4437  7E                  	ld		a,(hl)
      68.  00:4438  E6 80               	and		080h
      69.  00:443A  B1                  	or		c
      70.  00:443B  4F                  	ld		c,a
      71.  00:443C  23 23 23 23         [4]	inc		hl
      72.  00:4440  7E                  	ld		a,(hl)
      73.  00:4441  E6 0C               	and		0Ch
      74.  00:4443  B1                  	or		c
      75.  00:4444  32 12 FD            	ld		(slotvar),a
      76.  00:4447  C9                  	ret
      77.  00:4448                      	
      78.  00:4448                      ; ------------------------------
      79.  00:4448                      ; look for the slot of ram
      80.  00:4448                      ; active in page 3
      81.  00:4448                      ; ------------------------------
      82.  00:4448                      
      83.  00:4448                      search_slotram:
      84.  00:4448  F3                  	di
      85.  00:4449  CD 38 01            	call	RSLREG
      86.  00:444C  07 07               [2]	rlca
      87.  00:444E  E6 03               	and		3
      88.  00:4450  4F                  	ld		c,a
      89.  00:4451  06 00               	ld		b,0
      90.  00:4453  21 C1 FC            	ld		hl,EXPTBL
      91.  00:4456  09                  	add		hl,bc
      92.  00:4457  7E                  	ld		a,(hl)
      93.  00:4458  E6 80               	and		080h
      94.  00:445A  28 0D               	jr		z,search_slotram0
      95.  00:445C  B1                  	or		c
      96.  00:445D  4F                  	ld		c,a
      97.  00:445E  23 23 23 23         [4]	inc		hl
      98.  00:4462  7E                  	ld		a,(hl)
      99.  00:4463  07 07 07 07         [4]	rlca
     100.  00:4467  E6 0C               	and		0Ch
     101.  00:4469                      search_slotram0:
     102.  00:4469  B1                  	or		c
     103.  00:446A  32 13 FD            	ld		(slotram),a
     104.  00:446D  C9                  	ret
     105.  00:446E                      	
     106.  00:446E                      ; ------------------------------
     107.  00:446E                      ; SETROMPAGE0
     108.  00:446E                      ; Set the chart in
     109.  00:446E                      ; Page 0
     110.  00:446E                      ; -----------------------------
     111.  00:446E                      
     112.  00:446E                      setrompage0:
     113.  00:446E  3A 12 FD            	ld		a,(slotvar)
     114.  00:4471  C3 8F 44            	jp		setslotpage0
     115.  00:4474                      
     116.  00:4474                      setrompage2:
     117.  00:4474  3A 12 FD            	ld		a,(slotvar)
     118.  00:4477  C3 05 45            	jp		setslotpage2
     119.  00:447A                      
     120.  00:447A                      setrampage2:
     121.  00:447A  3A 13 FD            	ld		a,(slotram)
     122.  00:447D  C3 05 45            	jp		setslotpage2
     123.  00:4480                      	
     124.  00:4480                      setrompage3:
     125.  00:4480  3A 12 FD            	ld		a,(slotvar)
     126.  00:4483  C3 4C 45            	jp		setslotpage3
     127.  00:4486                      
     128.  00:4486                      setrampage3:
     129.  00:4486  3A 13 FD            	ld		a,(slotram)
     130.  00:4489  C3 4C 45            	jp		setslotpage3
     131.  00:448C                      	
     132.  00:448C                      ; ------------------------------
     133.  00:448C                      ; RECBIOS
     134.  00:448C                      ; set the bios ROM
     135.  00:448C                      ; -------------------------------
     136.  00:448C                      recbios:
     137.  00:448C  3A C1 FC            	ld		a,(EXPTBL)
     138.  00:448F                      
     139.  00:448F                      ; ---------------------------
     140.  00:448F                      ; SETSLOTPAGE0
     141.  00:448F                      ; Set the slot passed in A
     142.  00:448F                      ; at page 0 in the Z80 address space
     143.  00:448F                      ; A: Format FxxxSSPP
     144.  00:448F                      ; ----------------------------
     145.  00:448F                      
     146.  00:448F                      setslotpage0:
     147.  00:448F  F3                  	di
     148.  00:4490  47                  	ld		b,a					; B = Slot param in FxxxSSPP format
     149.  00:4491  DB A8               	in		a,(0A8h)
     150.  00:4493  E6 FC               	and		0xFC
     151.  00:4495  57                  	ld		d,a					; D = Primary slot value
     152.  00:4496  78                  	ld		a,b
     153.  00:4497  E6 03               	and		3
     154.  00:4499  B2                  	or		d
     155.  00:449A  57                  	ld		d,a		; D = Final Value for primary slot
     156.  00:449B  78                  	ld		a,b		; Check if expanded
     157.  00:449C  CB 7F               	bit		7,a
     158.  00:449E  28 22               	jr		z,1f	; Not Expanded
     159.  00:44A0                      	mainslot_setup	0
     159.  00:44A0  E6 03             >  and  3
     159.  00:44A2  0F 0F             > [2] rrca
     159.  00:44A4  E6 C0             >  and  0xC0
     159.  00:44A6  4F                >  ld  c,a
     159.  00:44A7  7A                >  ld  a,d
     159.  00:44A8  E6 3F             >  and  0x3F
     159.  00:44AA  B1                >  or  c
     159.  00:44AB  4F                >  ld  c,a
     159.  00:44AC                    > 
     159.  00:44AC  78                >  ld  a,b
     159.  00:44AD  E6 0C             >  and  0x0C
     159.  00:44AF  0F 0F             > [2] rrca
     159.  00:44B1  E6 03             >  and  3
     159.  00:44B3  47                >  ld  b,a
     159.  00:44B4  79                >  ld  a,c
     159.  00:44B5  D3 A8             >  out  (0A8h),a
     159.  00:44B7  3A FF FF          >  ld  a,(0FFFFh)
     159.  00:44BA  2F                >  cpl
     159.  00:44BB                    >  if (n<=4)
     159.  00:44BB                    > [n] RLCA
     159.  00:44BB                    >  else
     159.  00:44BB                    ~ [8-n] RRCA
     159.  00:44BB                    ~  endif
     159.  00:44BB  E6 FC             >  and  0xFC
     159.  00:44BD  B0                >  or  b
     159.  00:44BE                    >  if (n<=4)
     159.  00:44BE                    > [n] RRCA
     159.  00:44BE                    >  else
     159.  00:44BE                    ~ [8-n] RLCA
     159.  00:44BE                    ~  endif
     159.  00:44BE  32 FF FF          >  ld  (0FFFFh),a
     159.  00:44C1  47                >  ld  b,a
     160.  00:44C2  7A                  1:	ld		a,d				; A = Final value
     161.  00:44C3  D3 A8               	out		(0A8h),a		; Slot Final. Ram, rom c, rom c, Main
     162.  00:44C5  C9                  	ret
     163.  00:44C6                      
     164.  00:44C6                      ; ---------------------------
     165.  00:44C6                      ; SETSLOTPAGE1
     166.  00:44C6                      ; Set the slot passed in A
     167.  00:44C6                      ; at page 1 in the Z80 address space
     168.  00:44C6                      ; A: Format FxxxSSPP
     169.  00:44C6                      ; ----------------------------
     170.  00:44C6                      
     171.  00:44C6                      setslotpage1:
     172.  00:44C6  F3                  	di
     173.  00:44C7  47                  	ld		b,a					; B = Slot param in FxxxSSPP format
     174.  00:44C8  DB A8               	in		a,(0A8h)
     175.  00:44CA  0F 0F               [2]	RRCA
     176.  00:44CC  E6 FC               	and		0xFC
     177.  00:44CE  57                  	ld		d,a					; D = Primary slot value
     178.  00:44CF  78                  	ld		a,b
     179.  00:44D0  E6 03               	and		3
     180.  00:44D2  B2                  	or		d
     181.  00:44D3  07 07               [2]	RLCA
     182.  00:44D5  57                  	ld		d,a		; D = Final Value for primary slot
     183.  00:44D6  78                  	ld		a,b		; Check if expanded
     184.  00:44D7  CB 7F               	bit		7,a
     185.  00:44D9  28 26               	jr		z,1f	; Not Expanded
     186.  00:44DB                      	mainslot_setup	6
     186.  00:44DB  E6 03             >  and  3
     186.  00:44DD  0F 0F             > [2] rrca
     186.  00:44DF  E6 C0             >  and  0xC0
     186.  00:44E1  4F                >  ld  c,a
     186.  00:44E2  7A                >  ld  a,d
     186.  00:44E3  E6 3F             >  and  0x3F
     186.  00:44E5  B1                >  or  c
     186.  00:44E6  4F                >  ld  c,a
     186.  00:44E7                    > 
     186.  00:44E7  78                >  ld  a,b
     186.  00:44E8  E6 0C             >  and  0x0C
     186.  00:44EA  0F 0F             > [2] rrca
     186.  00:44EC  E6 03             >  and  3
     186.  00:44EE  47                >  ld  b,a
     186.  00:44EF  79                >  ld  a,c
     186.  00:44F0  D3 A8             >  out  (0A8h),a
     186.  00:44F2  3A FF FF          >  ld  a,(0FFFFh)
     186.  00:44F5  2F                >  cpl
     186.  00:44F6                    >  if (n<=4)
     186.  00:44F6                    ~ [n] RLCA
     186.  00:44F6                    ~  else
     186.  00:44F6  0F 0F             > [8-n] RRCA
     186.  00:44F8                    >  endif
     186.  00:44F8  E6 FC             >  and  0xFC
     186.  00:44FA  B0                >  or  b
     186.  00:44FB                    >  if (n<=4)
     186.  00:44FB                    ~ [n] RRCA
     186.  00:44FB                    ~  else
     186.  00:44FB  07 07             > [8-n] RLCA
     186.  00:44FD                    >  endif
     186.  00:44FD  32 FF FF          >  ld  (0FFFFh),a
     186.  00:4500  47                >  ld  b,a
     187.  00:4501  7A                  1:	ld		a,d				; A = Final value
     188.  00:4502  D3 A8               	out		(0A8h),a		; Slot Final. Ram, rom c, rom c, Main
     189.  00:4504  C9                  	ret
     190.  00:4505                      	
     191.  00:4505                      
     192.  00:4505                      ; ---------------------------
     193.  00:4505                      ; SETSLOTPAGE2
     194.  00:4505                      ; Set the slot passed in A
     195.  00:4505                      ; at page 2 in the Z80 address space
     196.  00:4505                      ; A: Format FxxxSSPP
     197.  00:4505                      ; ----------------------------
     198.  00:4505                      
     199.  00:4505                      setslotpage2:
     200.  00:4505  F3                  	di
     201.  00:4506  47                  	ld		b,a					; B = Slot param in FxxxSSPP format
     202.  00:4507  DB A8               	in		a,(0A8h)
     203.  00:4509  07 07 07 07         [4]	RLCA
     204.  00:450D  E6 FC               	and		0xFC
     205.  00:450F  57                  	ld		d,a					; D = Primary slot value
     206.  00:4510  78                  	ld		a,b
     207.  00:4511  E6 03               	and		3
     208.  00:4513  B2                  	or		d
     209.  00:4514  0F 0F 0F 0F         [4]	RRCA
     210.  00:4518  57                  	ld		d,a		; D = Final Value for primary slot
     211.  00:4519  78                  	ld		a,b		; Check if expanded
     212.  00:451A  CB 7F               	bit		7,a
     213.  00:451C  28 2A               	jr		z,1f	; Not Expanded
     214.  00:451E                      	mainslot_setup	4
     214.  00:451E  E6 03             >  and  3
     214.  00:4520  0F 0F             > [2] rrca
     214.  00:4522  E6 C0             >  and  0xC0
     214.  00:4524  4F                >  ld  c,a
     214.  00:4525  7A                >  ld  a,d
     214.  00:4526  E6 3F             >  and  0x3F
     214.  00:4528  B1                >  or  c
     214.  00:4529  4F                >  ld  c,a
     214.  00:452A                    > 
     214.  00:452A  78                >  ld  a,b
     214.  00:452B  E6 0C             >  and  0x0C
     214.  00:452D  0F 0F             > [2] rrca
     214.  00:452F  E6 03             >  and  3
     214.  00:4531  47                >  ld  b,a
     214.  00:4532  79                >  ld  a,c
     214.  00:4533  D3 A8             >  out  (0A8h),a
     214.  00:4535  3A FF FF          >  ld  a,(0FFFFh)
     214.  00:4538  2F                >  cpl
     214.  00:4539                    >  if (n<=4)
     214.  00:4539  07 07 07 07       > [n] RLCA
     214.  00:453D                    >  else
     214.  00:453D                    ~ [8-n] RRCA
     214.  00:453D                    ~  endif
     214.  00:453D  E6 FC             >  and  0xFC
     214.  00:453F  B0                >  or  b
     214.  00:4540                    >  if (n<=4)
     214.  00:4540  0F 0F 0F 0F       > [n] RRCA
     214.  00:4544                    >  else
     214.  00:4544                    ~ [8-n] RLCA
     214.  00:4544                    ~  endif
     214.  00:4544  32 FF FF          >  ld  (0FFFFh),a
     214.  00:4547  47                >  ld  b,a
     215.  00:4548  7A                  1:	ld		a,d				; A = Final value
     216.  00:4549  D3 A8               	out		(0A8h),a		; Slot Final. Ram, rom c, rom c, Main
     217.  00:454B  C9                  	ret
     218.  00:454C                      	
     219.  00:454C                      ; ---------------------------
     220.  00:454C                      ; SETSLOTPAGE3
     221.  00:454C                      ; Set the slot passed in A
     222.  00:454C                      ; at page 3 in the Z80 address space
     223.  00:454C                      ; A: Format FxxxSSPP
     224.  00:454C                      ; ----------------------------
     225.  00:454C                      	
     226.  00:454C                      setslotpage3:
     227.  00:454C  F3                  	di
     228.  00:454D  47                  	ld		b,a					; B = Slot param in FxxxSSPP format
     229.  00:454E  DB A8               	in		a,(0A8h)
     230.  00:4550  07 07               [2]	RLCA
     231.  00:4552  E6 FC               	and		0xFC
     232.  00:4554  57                  	ld		d,a					; D = Primary slot value
     233.  00:4555  78                  	ld		a,b
     234.  00:4556  E6 03               	and		3
     235.  00:4558  B2                  	or		d
     236.  00:4559  0F 0F               [2]	RRCA	
     237.  00:455B  57                  	ld		d,a		; D = Final Value for primary slot
     238.  00:455C  78                  	ld		a,b		; Check if expanded
     239.  00:455D  CB 7F               	bit		7,a
     240.  00:455F  28 26               	jr		z,1f	; Not Expanded
     241.  00:4561                      	mainslot_setup	2
     241.  00:4561  E6 03             >  and  3
     241.  00:4563  0F 0F             > [2] rrca
     241.  00:4565  E6 C0             >  and  0xC0
     241.  00:4567  4F                >  ld  c,a
     241.  00:4568  7A                >  ld  a,d
     241.  00:4569  E6 3F             >  and  0x3F
     241.  00:456B  B1                >  or  c
     241.  00:456C  4F                >  ld  c,a
     241.  00:456D                    > 
     241.  00:456D  78                >  ld  a,b
     241.  00:456E  E6 0C             >  and  0x0C
     241.  00:4570  0F 0F             > [2] rrca
     241.  00:4572  E6 03             >  and  3
     241.  00:4574  47                >  ld  b,a
     241.  00:4575  79                >  ld  a,c
     241.  00:4576  D3 A8             >  out  (0A8h),a
     241.  00:4578  3A FF FF          >  ld  a,(0FFFFh)
     241.  00:457B  2F                >  cpl
     241.  00:457C                    >  if (n<=4)
     241.  00:457C  07 07             > [n] RLCA
     241.  00:457E                    >  else
     241.  00:457E                    ~ [8-n] RRCA
     241.  00:457E                    ~  endif
     241.  00:457E  E6 FC             >  and  0xFC
     241.  00:4580  B0                >  or  b
     241.  00:4581                    >  if (n<=4)
     241.  00:4581  0F 0F             > [n] RRCA
     241.  00:4583                    >  else
     241.  00:4583                    ~ [8-n] RLCA
     241.  00:4583                    ~  endif
     241.  00:4583  32 FF FF          >  ld  (0FFFFh),a
     241.  00:4586  47                >  ld  b,a
     242.  00:4587  7A                  1:	ld		a,d				; A = Final value
     243.  00:4588  D3 A8               	out		(0A8h),a		; Slot Final. Ram, rom c, rom c, Main
     244.  00:458A  C9                  	ret
     576   00:458B                               include sccdetec.asm
       1.  00:458B                      
       2.  00:458B                       ; ====================
       3.  00:458B                       ;    Initialization
       4.  00:458B                       ; ====================
       5.  00:458B                      SCCsearch
       6.  00:458B  21 C0 45             	ld	hl,begin
       7.  00:458E  11 00 C0             	ld	de,0C000H
       8.  00:4591  01 7E 00             	ld	bc,end-begin+1
       9.  00:4594  ED B0                	ldir
      10.  00:4596  CD 00 C0             	call	0C000H
      11.  00:4599  78                   	ld	a,b
      12.  00:459A  32 14 FD             	ld	(SCC),a
      13.  00:459D  C9                   	ret
      14.  00:459E                       
      15.  00:459E                       ; SLOT            .db     0
      16.  00:459E                       ; PAGE1RAM        .db     0
      17.  00:459E                       ; RAMSLOT         .db     0
      18.  00:459E                       
      19.  00:459E                       ; SCC             .db     0
      20.  00:459E                       ; SUB             .db     0FFH
      21.  00:459E                       
      22.  00:459E                       
      23.  00:459E                      en_scc:
      24.  00:459E  3A 14 FD            	ld	a,[SCC]
      25.  00:45A1  3C                  	inc	a
      26.  00:45A2  C8                  	ret	z			; no scc
      27.  00:45A3                      	; ld	a,(0xFFFF)
      28.  00:45A3                      	; cpl
      29.  00:45A3                      	; ld	(cursubslots),a
      30.  00:45A3  DB A8               	in	a,(0xA8)	; Leemos el registro principal de slots
      31.  00:45A5  32 15 FD            	ld	(curslot),a	; save it
      32.  00:45A8  5F                  	ld	e,a
      33.  00:45A9  3A 14 FD            	ld	a,(SCC)
      34.  00:45AC  E6 03               	and	0x03		; Nos fijamos en el slot primario
      35.  00:45AE  87 87 87 87         [4]	add	a,a
      36.  00:45B2  57                  	ld	d,a
      37.  00:45B3  7B                  	ld	a,e			; registro principal de slots
      38.  00:45B4  E6 CF               	and	11001111b
      39.  00:45B6  B2                  	or	d
      40.  00:45B7  D3 A8               	out (0xA8),a
      41.  00:45B9                      	; ld	(sccslots),a
      42.  00:45B9                      	; ld	a,(0xFFFF)
      43.  00:45B9                      	; cpl
      44.  00:45B9                      	; ld	(sccsubslots),a
      45.  00:45B9  C9                  	ret
      46.  00:45BA                      	
      47.  00:45BA                      en_slot:
      48.  00:45BA  3A 15 FD            	ld	a,(curslot)
      49.  00:45BD  D3 A8               	out (0xA8),a
      50.  00:45BF                      	; ld	a,(cursubslots)
      51.  00:45BF                      	; ld	(0xFFFF),a
      52.  00:45BF  C9                  	ret
      53.  00:45C0                      
      54.  00:45C0                      
      55.  00:45C0                      ;------------------------------------------------------------
      56.  00:45C0                      ; SCC-search v1.0
      57.  00:45C0                      ; by Alwin Henseler
      58.  00:45C0                      ; using method described in bulletin # 18 MSX-club Enschede
      59.  00:45C0                      ; input: none
      60.  00:45C0                      ; output: B=slot that contains SCC (=255 if no SCC found)
      61.  00:45C0                      
      62.  00:45C0  (00:0024)           enaslt:          equ #0024
      63.  00:45C0  (00:FCC1)           exptbl:          equ #fcc1
      64.  00:45C0  (00:FCC5)           slttbl:          equ #fcc5
      65.  00:45C0                      
      66.  00:45C0                      begin:
      67.  00:45C0  (C000)              	MAP #c000
      68.  00:45C0  DB A8               	in a,(#a8)        ; read prim. slotregister
      69.  00:45C2  1F                  	rra
      70.  00:45C3  1F                  	rra
      71.  00:45C4  1F                  	rra
      72.  00:45C5  1F                  	rra
      73.  00:45C6  E6 03               	and %00000011     ; A = prim.slot page 2
      74.  00:45C8  06 00               	ld b,0
      75.  00:45CA  4F                  	ld c,a
      76.  00:45CB  21 C1 FC            	ld hl,exptbl
      77.  00:45CE  09                  	add hl,bc
      78.  00:45CF  CB 7E               	bit 7,(hl)        ; page 2-slot expanded ?
      79.  00:45D1  28 0C               	jr z,scctest
      80.  00:45D3  21 C5 FC            	ld hl,slttbl
      81.  00:45D6  09                  	add hl,bc
      82.  00:45D7  7E                  	ld a,(hl)         ; A = sec.sel.reg. of page 2-slot
      83.  00:45D8  1F                  	rra
      84.  00:45D9  1F                  	rra
      85.  00:45DA  E6 0C               	and %00001100     ; bit 1/2 = sec.slot page 2
      86.  00:45DC  B1                  	or c
      87.  00:45DD  CB FF               	set 7,a           ; compose sec.slot-code
      88.  00:45DF                      scctest:
      89.  00:45DF  F5                  	push af           ; save page 2-slot on the stack
      90.  00:45E0  3A C1 FC            	ld a,(exptbl)     ; 1st slot to test
      91.  00:45E3                      
      92.  00:45E3                      testslot:        
      93.  00:45E3  F5                  	push af           ; save test-slot on the stack
      94.  00:45E4  26 80               	ld h,#80
      95.  00:45E6  CD 24 00            	call enaslt       ; switch slot-to-test in 8000-bfffh
      96.  00:45E9  21 00 90            	ld hl,#9000
      97.  00:45EC  46                  	ld b,(hl)         ; save contents of address 9000h
      98.  00:45ED  36 3F               	ld (hl),#3f       ; activate SCC (if present)
      99.  00:45EF                      
     100.  00:45EF  AF                  	xor	a
     101.  00:45F0  32 FE BF            	ld (0xbffe),a	  ; scc+ patch for bluemsx
     102.  00:45F3                      
     103.  00:45F3  26 9C               	ld h,#9c          ; address of SCC-register mirrors
     104.  00:45F5  11 00 98            	ld de,#9800       ; 9800h = address of SCC-registers
     105.  00:45F8                      testreg:         
     106.  00:45F8  1A                  	ld a,(de)
     107.  00:45F9  4F                  	ld c,a            ; save contents of address 98xxh
     108.  00:45FA  7E                  	ld a,(hl)         ; read byte from address 9cxxh
     109.  00:45FB  2F                  	cpl               ; and invert it
     110.  00:45FC  12                  	ld (de),a         ; write inverted byte to 98xxh
     111.  00:45FD  BE                  	cp (hl)           ; same value on 9cxxh ?
     112.  00:45FE  79                  	ld a,c
     113.  00:45FF  12                  	ld (de),a         ; restore value on 98xxh
     114.  00:4600  20 0D               	jr nz,nextslot    ; unequal -> no SCC -> continue search
     115.  00:4602  23                  	inc hl
     116.  00:4603  13                  	inc de            ; next test-addresses
     117.  00:4604  CB 7D               	bit 7,l           ; 128 addresses (registers) tested ?
     118.  00:4606  28 F0               	jr z,testreg      ; no -> repeat mirror-test
     119.  00:4608  78                  	ld a,b
     120.  00:4609  32 00 90            	ld (#9000),a      ; restore value on 9000h
     121.  00:460C  C1                  	pop bc            ; retrieve slotcode (=SCC-slot) from stack
     122.  00:460D  18 24               	jr done           ; SCC found, restore page 2-slot & return
     123.  00:460F                      
     124.  00:460F                      nextslot:
     125.  00:460F  78                  	ld a,b
     126.  00:4610  32 00 90            	ld (#9000),a      ; restore value on 9000h
     127.  00:4613  C1                  	pop bc            ; retrieve slotcode from stack
     128.  00:4614  CB 78               	bit 7,b           ; test-slot = sec.slot ?
     129.  00:4616  28 07               	jr z,nextprim
     130.  00:4618  78                  	ld a,b
     131.  00:4619  C6 04               	add a,4           ; increase sec.slotnumber
     132.  00:461B  CB 67               	bit 4,a           ; sec.slot = 4 ?
     133.  00:461D  28 C4               	jr z,testslot
     134.  00:461F                      nextprim:
     135.  00:461F  78                  	ld a,b
     136.  00:4620  E6 03               	and %00000011
     137.  00:4622  FE 03               	cp 3              ; prim.slot = 3 ?
     138.  00:4624  28 0B               	jr z,noscc
     139.  00:4626  3C                  	inc a             ; increase prim.slotnumber
     140.  00:4627  16 00               	ld d,0
     141.  00:4629  5F                  	ld e,a
     142.  00:462A  21 C1 FC            	ld hl,exptbl
     143.  00:462D  19                  	add hl,de
     144.  00:462E  B6                  	or (hl)           ; combine slot-expansion with slotcode
     145.  00:462F  18 B2               	jr testslot
     146.  00:4631                      
     147.  00:4631                      noscc:           
     148.  00:4631  06 FF               	ld b,255          ; code for no SCC
     149.  00:4633                      done:            
     150.  00:4633  F1                  	pop af            ; retrieve page 2-slot from stack
     151.  00:4634  C5                  	push bc
     152.  00:4635  26 80               	ld h,#80
     153.  00:4637  CD 24 00            	call enaslt       ; restore original page 2-slot
     154.  00:463A  C1                  	pop bc
     155.  00:463B  FB                  	ei
     156.  00:463C  C9                  	ret
     157.  00:463D                      end:
     158.  00:463D  (0000)              	endmap				 
     159.  00:463D                      ; -------------------------------------------------------------
     160.  00:463D                      
     577   00:463D                      
     578   00:463D                      ;-------------------------------------
     579   00:463D                      ; Padding for rom player
     580   00:463D                      ;-------------------------------------
     581   00:463D  00 (6595)                   ds	$6000 - $
     582   00:6000                      
     583   00:6000                      
     584   00:6000                      
     585   00:6000                      ;-------------------------------------
     586   00:6000                      ; Sample data
     587   00:6000                      ;-------------------------------------
     588   00:6000                      SAMPLE_START:
     589   00:6000                               include DataTable.asm
       1.  00:6000                      s0_START:
       2.  00:6000  (2580)                       incbin data0.bin 
       3.  00:8580                      s0_END:
       4.  00:8580                      s1_START:
       5.  00:8580  (1E00)                       incbin data1.bin 
       6.  00:A380                      s1_END:
       7.  00:A380                      s2_START:
       8.  00:A380  (0360)                       incbin data2.bin 
       9.  00:A6E0                      s2_END:
      10.  00:A6E0                      s3_START:
      11.  00:A6E0  (2400)                       incbin data3.bin 
      12.  00:CAE0                      s3_END:
      13.  00:CAE0                      s4_START:
      14.  00:CAE0  (0120)                       incbin data4.bin 
      15.  00:CC00                      s4_END:
      16.  00:CC00                      s5_START:
      17.  00:CC00  (05A0)                       incbin data5.bin 
      18.  00:D1A0                      s5_END:
      19.  00:D1A0                      s6_START:
      20.  00:D1A0  (17A0)                       incbin data6.bin 
      21.  00:E940                      s6_END:
      22.  00:E940                      s7_START:
      23.  00:E940  (3360)                       incbin data7.bin 
      24.  00!1CA0                      s7_END:
      25.  00!1CA0                      s8_START:
      26.  00!1CA0  (6B40)                       incbin data8.bin 
      27.  00!87E0                      s8_END:
     590   00!87E0                      SAMPLE_END:
     591   00!87E0                      
     592   00!87E0                      
     593   00!87E0                      
     594   00!87E0                      ;-------------------------------------
     595   00!87E0                      ; Padding, align rom image to a power of two.
     596   00!87E0                      ;-------------------------------------
     597   00!87E0                      
     598   00!87E0  (00:127E0)          SAMPLE_LENGTH:  equ SAMPLE_END - SAMPLE_START
     599   00!87E0                      
     600   00!87E0                      
     601   00!87E0                      
SccReplayer3c_bas.asm(602) : Forward reference
     602   00!87E0                              IF (SAMPLE_LENGTH <= 6000h)
     603   00!87E0                    ~         DS (06000h - SAMPLE_LENGTH)
     604   00!87E0                    ~         ELSE
SccReplayer3c_bas.asm(605) : Forward reference
     605   00!87E0                              IF (SAMPLE_LENGTH <= 10000h-2000h)
     606   00!87E0                    ~         DS (0E000h - SAMPLE_LENGTH)
     607   00!87E0                    ~         ELSE
SccReplayer3c_bas.asm(608) : Forward reference
     608   00!87E0                              IF (SAMPLE_LENGTH <= 1E000h)
     609   00!87E0  00 (47136)                  DS (01E000h - SAMPLE_LENGTH)
     610   00!4000                              ELSE
SccReplayer3c_bas.asm(611) : Forward reference
     611   00!4000                    ~         IF (SAMPLE_LENGTH <= 3E000h)
     612   00!4000                    ~         DS (03E000h - SAMPLE_LENGTH)
     613   00!4000                    ~         ELSE
SccReplayer3c_bas.asm(614) : Forward reference
     614   00!4000                    ~         IF (SAMPLE_LENGTH <= 7E000h)
     615   00!4000                    ~         DS (07E000h - SAMPLE_LENGTH)
     616   00!4000                    ~         ELSE
     617   00!4000                    ~         DS (0FE000h - SAMPLE_LENGTH)
     618   00!4000                    ~         ENDIF
     619   00!4000                    ~         ENDIF
     620   00!4000                    ~         ENDIF
     621   00!4000                              ENDIF
     622   00!4000                              ENDIF
     623   00!4000                      
     624   00!4000                      
     625   00!4000                      
     626   00!4000                      FINISH:
     627   00!4000                      
     628   00!4000                      
     629   00!4000                      ;---------------------------------------------------------
     630   00!4000                      ; Variables
     631   00!4000                      ;---------------------------------------------------------
     632   00!4000  (FD09)              					map 0xFD09		; unused ram
     633   00!4000                      
     634   00!4000                      
     635   00!4000  (00:FD09)           SamplePos:          #	2
     636   00!4000  (00:FD0B)           SamplePage:         #	1
     637   00!4000  (00:FD0C)           sccslots			#	1
     638   00!4000  (00:FD0D)           Period:             #	2
     639   00!4000  (00:FD0F)           NumBlocksToPlay:    #	2
     640   00!4000                      
     641   00!4000  (00:FD11)           SccSfxOn:           #	1
     642   00!4000                      
     643   00!4000  (00:FD12)           slotvar:            #	1
     644   00!4000  (00:FD13)           slotram:            #	1
     645   00!4000  (00:FD14)           SCC:            	#	1
     646   00!4000  (00:FD15)           curslot:            #	1
     647   00!4000                      
     648   00!4000  (00:FD16)           USR0:				#	5
     649   00!4000  (0000)              					endmap
     650   00!4000                      					

    LABELS
-------------------------------------------------
00:00006000   Bank1
00:00006800   Bank2
00:00007000   Bank3
00:00007800   Bank4
00:00009000   sccBank3
00:00004010   START
00:000040A1 X START.halt
00:000040C7   effetct24
00:000040EC   message
00:000040FE   noSCC_text
00:0000410F   instruction_text
00:0000412B   scc_slot_text
00:00004136   rom_slot_text
00:00004141   ram_slot_text
00:0000414C   InstallIntHanlder
00:00004180   HandleUsr
00:00004191   HandleInt
00:000041A1   ReplayerInit
00:000041C9   SfxTable
00:00000009 X nwavs
00:000041F6   ReplayerUpdate
00:0000431C   ReplayerMute
00:00004324   init_mapper
00:00004336   PrintNum
00:00004380   Numbers
00:000008BC X Period50
00:00000749   Period60
00:00004390   SccAdjust
00:000043A9   SccAdjust.counter
00:000043BE   SccAdjust.loop
00:000043DC   SccAdjust.end
00:000043E0   SccInit
00:00004410   SccMute
00:000000A8 X i8255porta
00:000000A9   i8255portb
00:000000AA   i8255portc
00:000000AB X i8255portd
00:0000441E   checkkbd
00:00000024 X ENASLT
00:00000138   RSLREG
00:0000013B X WSLREG
00:0000FCC1   EXPTBL
00:00004429   search_slot
00:00004448   search_slotram
00:00004469   search_slotram0
00:0000446E X setrompage0
00:00004474 X setrompage2
00:0000447A X setrampage2
00:00004480 X setrompage3
00:00004486 X setrampage3
00:0000448C X recbios
00:0000448F   setslotpage0
00:000044C6 X setslotpage1
00:00004505   setslotpage2
00:0000454C   setslotpage3
00:0000458B   SCCsearch
00:0000459E   en_scc
00:000045BA   en_slot
00:00000024   enaslt
00:0000FCC1   exptbl
00:0000FCC5   slttbl
00:000045C0   begin
00:000045DF   scctest
00:000045E3   testslot
00:000045F8   testreg
00:0000460F   nextslot
00:0000461F   nextprim
00:00004631   noscc
00:00004633   done
00:0000463D   end
00:00006000   SAMPLE_START
00:00006000   s0_START
00:00008580   s0_END
00:00008580   s1_START
00:0000A380   s1_END
00:0000A380   s2_START
00:0000A6E0   s2_END
00:0000A6E0   s3_START
00:0000CAE0   s3_END
00:0000CAE0   s4_START
00:0000CC00   s4_END
00:0000CC00   s5_START
00:0000D1A0   s5_END
00:0000D1A0   s6_START
00:0000E940   s6_END
00:0000E940   s7_START
00:00011CA0   s7_END
00:00011CA0   s8_START
00:000187E0   s8_END
00:000187E0   SAMPLE_END
00:000127E0   SAMPLE_LENGTH
00:00024000 X FINISH
00:0000FD09   SamplePos
00:0000FD0B   SamplePage
00:0000FD0C X sccslots
00:0000FD0D   Period
00:0000FD0F   NumBlocksToPlay
00:0000FD11   SccSfxOn
00:0000FD12   slotvar
00:0000FD13   slotram
00:0000FD14   SCC
00:0000FD15   curslot
00:0000FD16   USR0


 Output: SccReplayer3c_bas.out
-------------------------------------------------

 Page: 00
  Org: 00004000  Size: *  Used: 00000000

    No output

 Output: sccplay3c_bas.rom
-------------------------------------------------

 Page: 00
  Org: 00004000  Size: *  Used: 00020000

   Address   Length Align   Label
   00004000  131072         START
